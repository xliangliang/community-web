<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>亮亮社区</title>
    <script src="static/js/jquery-1.12.4.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="static/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="static/css/bootstrap-theme.min.css"/>

    <style>
        .text-desc {
            font-size: 12px;
            font-weight: normal;
            color: #999;
        }
    </style>

    <script>
        // 默认页条数
        var DefaultPageSize = 10;

        $(document).ready(function () {
            var token = localStorage.getItem("token");
            if (token != null || token != "") {
                $.ajax({
                    type: "post",
                    url: "/api/admin/refreshToken",
                    contentType: "application/json",
                    cache: false,
                    beforeSend: function (XHR) {
                        XHR.setRequestHeader("Authorization", token);
                    },
                    success: function (result) {
                        if (result.code == 200) {
                            setTokenCookie(result);
                            $("#iusername").text(result.data.username);
                            $("#ilogin").css("visibility", "hidden");
                        } else {
                            clearTokenCookie();
                            $("#iinfo").css("visibility", "hidden");
                            $("#ipublic").css("visibility", "hidden");
                        }
                    }
                });
            }
            <!-- 分页 -->
            addContext(1, DefaultPageSize);
        });

        function changePage(obj) {
            var curPage = obj.text;
            addContext(curPage, DefaultPageSize);
        }

        function gotoStart() {
            addContext(1, DefaultPageSize);
        }

        function gotoEnd() {
            var curPage = $("#getPageTotal")[0].textContent;
            addContext(curPage, DefaultPageSize);
        }

        <!-- 参数1：当前页数， 参数2：页条数 -->
        function addContext(curPage, pageSize) {
            $.ajax({
                type: "GET",
                url: "/api/index/newest",
                contentType: "application/json",
                cache: false,
                dataType: "json",
                data: {
                    "pageNum": curPage,
                    "pageSize": pageSize
                },
                success: function (result) {
                    if (result.code == 200) {
                        var item;
                        $(".question-text").remove();
                        $.each(result.data.list, function (index, value) {
                            item += "<div class=\"col-md-12 question-text\" style=\"height: 60px\">\n" +
                                "        <div class=\"media\">\n" +
                                "            <div class=\"media-left\">\n" +
                                "                <img src=" + value.icon + " alt=\"用户头像\" class=\"img-rounded pull-left\"\n" +
                                "                    style=\"width: 60px; height: 60px\">\n" +
                                "            </div>\n" +
                                "            <div class=\"media-body\">\n" +
                                "                <h4 class=\"media-heading\"> <a href=\"#\">" + value.title + "</a> </h4>\n" +
                                "                <span class=\"text-desc\"> <a href=\"#\">" + value.nickName + "</a> 发起了问题 • " + value.commentCount + " 个回复 • " + value.viewCount + " 次浏览 • " + timeStamp2String(value.createTime) + "</span>\n" +
                                "            </div>\n" +
                                "        </div>\n" +
                                "    </div>";

                            /*item += "<div class=\"col-md-12 question-text\" style=\"height: 60px\">"
                                + "      <img src=\"static/img/liangliang_login.PNG\" alt=\"用户头像\" class=\"img-rounded pull-left\" style=\"width: 60px; height: 60px\">"
                                + "      <h4>" + value.title + "</h4>"
                                + "      <p><span class=\"description\">发布了文章</span></p>"
                                + "</div>";*/
                        });
                        $("#questionText").append(item);
                        createPage(result.data.totalPage, result.data.pageNum);
                    }
                }
            });
        }

        function createPage(pageTotal, pageNum) {
            $("ul li.data-table").remove();
            var index = 1;
            var end;
            var string = "";
            if (pageNum != 1) {
                string = "<li class=\"data-table\" onclick=\"gotoStart()\">\n" +
                    "             <a href=\"#\" aria-label=\"Previous\">\n" +
                    "                 <span aria-hidden=\"true\">&laquo;</span>\n" +
                    "             </a>\n" +
                    "         </li>";
            } else {
                string = "<li class=\"data-table\" style=\"visibility: hidden\">\n" +
                    "             <a href=\"#\" aria-label=\"Previous\">\n" +
                    "                 <span aria-hidden=\"true\">&laquo;</span>\n" +
                    "             </a>\n" +
                    "         </li>";
            }

            if (pageNum < 4) {
                index = 1;
            } else if (pageNum + 1 == pageTotal) {
                index = pageNum - 3;
            } else if (pageNum == pageTotal) {
                index = pageNum - 4;
            } else {
                index = pageNum - 2;
            }
            if (pageTotal >= index + 4) {
                end = index + 4;
            } else {
                end = pageTotal;
            }
            for (; index <= end; index++) {
                if (index == pageNum) {
                    string += "<li class=\"data-table active\"><a href=\"#\">" + index + "</a></li>";
                } else {
                    string += "<li class='data-table'><a href=\"#\" onclick=\"changePage(this)\">" + index + "</a></li>";
                }
            }
            if (pageNum != pageTotal) {
                string += "<li class=\"data-table\" onclick=\"gotoEnd(this)\">\n" +
                    "          <a href=\"#\" aria-label=\"Next\">\n" +
                    "              <span style=\"display: none\" id=\"getPageTotal\">" + pageTotal + "</span>\n" +
                    "              <span aria-hidden=\"true\">&raquo;</span>\n" +
                    "          </a>\n" +
                    "      </li>";
            } else {
                string += "<li class=\"data-table\" style=\"visibility: hidden\">\n" +
                    "          <a href=\"#\" aria-label=\"Next\">\n" +
                    "              <span aria-hidden=\"true\">&raquo;</span>\n" +
                    "          </a>\n" +
                    "      </li>";
            }
            $("#cPage").append(string);
        }

        function timeStamp2String(time) {
            var datetime = new Date(time);
            var year = datetime.getFullYear();
            var month = datetime.getMonth() + 1 < 10 ? "0" + (datetime.getMonth() + 1) : datetime.getMonth() + 1;
            var date = datetime.getDate() < 10 ? "0" + datetime.getDate() : datetime.getDate();
            var hour = datetime.getHours() < 10 ? "0" + datetime.getHours() : datetime.getHours();
            var minute = datetime.getMinutes() < 10 ? "0" + datetime.getMinutes() : datetime.getMinutes();
            var second = datetime.getSeconds() < 10 ? "0" + datetime.getSeconds() : datetime.getSeconds();
            return year + "-" + month + "-" + date + " " + hour + ":" + minute + ":" + second;
        }

        function setTokenCookie(result) {
            localStorage.setItem("token", result.data.token);
            localStorage.setItem("username", result.data.username);
        }

        function clearTokenCookie() {
            localStorage.removeItem("token");
            localStorage.removeItem("username");
        }
    </script>
</head>
<body>
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">亮亮社区</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">亮亮社区</a>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <form class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="搜索问题、话题或人">
                </div>
                <button type="submit" class="btn btn-default">搜索</button>
            </form>
            <ul class="nav navbar-nav">
                <li><a href="#">发现</a></li>
                <li><a href="#">分享</a></li>
                <li><a href="#">文章</a></li>
                <li><a href="#">话题</a></li>
                <li><a href="#">活动</a></li>
                <li><a href="#">帮助</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right navbar-collapse">
                <li class="nav-item" id="ilogin">
                    <a href="login.html" class="nav-link">登录</a>
                </li>
                <li class="nav-item" id="ipublic">
                    <a href="publish.html" class="nav-link glyphicon glyphicon-edit">发布</a>
                </li>
                <li class="nav-item dropdown" id="iinfo">

                    <a id="dropdownSubMenu1" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                       class="nav-link dropdown-toggle"><span id="iusername"></span> <span class="caret"></span></a>
                    <ul aria-labelledby="dropdownSubMenu1" class="dropdown-menu border-0 shadow">
                        <li><a href="#" class="dropdown-item">个人信息 </a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#" class="dropdown-item">退出登录</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav><!--nav-->

<div class="container-fluid">
    <div class="col-md-9">
        <ul class="nav nav-tabs col-md-12" role="tablist">
            <li role="presentation" class="pull-right"><a href="#hot" aria-controls="hot" data-toggle="tab">热门</a></li>
            <li role="presentation" class="pull-right"><a href="#recommended" aria-controls="recommended"
                                                          data-toggle="tab">推荐</a></li>
            <li role="presentation" class="active pull-right"><a href="#newest" aria-controls="newest"
                                                                 data-toggle="tab">最新</a></li>
        </ul>

        <div class="tab-content">
            <div role="tabpanel" class="tab-pane active" id="newest">
                <div id="questionText">
                    <!-- 内容模型 -->
                    <!--<div class="col-md-12" style="height: 60px">
                        <div class="media">
                            <div class="media-left">
                                <img src="static/img/liangliang_login.PNG" alt="用户头像" class="img-rounded pull-left"
                                     style="width: 60px; height: 60px">
                            </div>
                            <div class="media-body">
                                <h4 class="media-heading">test</h4>

                                <span class="text-desc">亮亮 发起了问题 • 1 个回复 • 1 次浏览 • 1 小时前</span>
                            </div>
                        </div>
                    </div>-->
                </div>

                <div class="col-md-12">
                    <ul class="pagination pull-right" id="cPage">
                        <!-- 页码数模型 -->
                        <!--<li class="data-table" id="previous">
                            <a href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="data-table active"><a href="#" onclick="changePage(this)">1</a></li>
                        <li class="data-table" id="next">
                            <a href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>-->
                    </ul>
                </div>
            </div>
            <div role="tabpanel" class="tab-pane" id="recommended">22222</div>
            <div role="tabpanel" class="tab-pane" id="hot">33</div>
        </div>
    </div>
    <div class="col-md-3" style="margin-top: 30px">
        <span id="test-span"></span>
    </div>
</div>

</body>
</html>